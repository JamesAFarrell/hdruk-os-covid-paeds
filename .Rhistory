left_join(
data_admissions %>%
group_by(patient_id, index) %>%
expand(gp_date = seq(admission_date, discharge_date, by = "day")) %>%
ungroup() %>%
mutate(admission_flag = 1) %>%
select(-index),
by = c("patient_id", "gp_date")
) %>%
replace_na(list(outpatient_flag = 0, admission_flag = 0)) %>%
mutate(
secondary_care_flag = if_else(
outpatient_flag == 1 | admission_flag == 1,
"Coincides with secondary care dataset",
"Unique to primary care dataset"
)
)
View(data_gp)
# Load datasets
data_admissions = read_rds(here::here("output", "data", "data_admissions.rds"))
data_outpatient = read_rds(here::here("output", "data", "data_outpatient.rds"))
data_gp = read_rds(here::here("output", "data", "data_gp.rds"))
data_gp = data_gp %>%
left_join(
data_outpatient %>%
mutate(outpatient_flag = 1) %>%
select(patient_id, gp_date = outpatient_date, outpatient_flag),
by = c("patient_id", "gp_date")
) %>%
left_join(
data_admissions %>%
group_by(patient_id, index) %>%
expand(gp_date = seq(admission_date, discharge_date, by = "day")) %>%
ungroup() %>%
mutate(admission_flag = 1) %>%
select(-index),
by = c("patient_id", "gp_date")
) %>%
replace_na(list(outpatient_flag = 0, admission_flag = 0)) %>%
mutate(
secondary_care_flag = if_else(
outpatient_flag == 1 | admission_flag == 1,
"Coincides with secondary care dataset",
"Unique to primary care dataset"
) %>%
factor()
)
data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(gp_date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n, fill = secondary_care_flag)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom")
x = data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(gp_date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup()
View(x)
x = data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(gp_date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date())
x = data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(gp_date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup()
data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n, fill = secondary_care_flag)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom")
data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ secondary_care_flag)
data_gp %>%
filter(patient_id %in% data_admissions$patient_id |
patient_id %in% data_outpatient$patient_id) %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(date, secondary_care_flag, .drop = FALSE) %>%
group_by(secondary_care_flag) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ secondary_care_flag)
data_gp %>%
filter(patient_id %in% data_admissions$patient_id |
patient_id %in% data_outpatient$patient_id) %>% pull(patient_id) %>% unique() %>% length()
data_gp %>%
pull(patient_id) %>% unique() %>% length()
?geom_histogram
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
) %>%
ggplot(aes(length_of_stay)) +
geom_histogram(
breaks = c(0:30)
) +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
) %>%
ggplot(aes(length_of_stay)) +
geom_histogram(
breaks = c(0:30,Inf)
) +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
) %>%
ggplot(aes(length_of_stay)) +
geom_histogram(
# breaks = c(0:30,Inf)
) +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
)
?cut
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date,
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(0:30))
)
data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(0:30))
)
View(data_admissions)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(0:30))
)
View(x)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(0:30, Inf))
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf))
)
x$length_of_stay.factor %>% levels()
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf)) %>%
fct_recode(
0 = "(-Inf,0]"
?fct_recode
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf)) %>%
fct_recode(
hi = "(-Inf,0]"
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf)) %>%
fct_recode(
0 = "(-Inf,0]"
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]"
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:30, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6,7]",
"7+" = "(7,Inf]"
)
)
View(x)
View(x)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:7, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6,7]",
"7+" = "(7,Inf]"
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6,Inf]",
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6, Inf]",
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6, Inf]",
)
) %>%
ggplot(aes(length_of_stay.factor)) +
geom_bar() +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7+" = "(6, Inf]",
)
) %>%
ggplot(aes(length_of_stay.factor)) +
geom_bar() +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6, 13]",
"14-29" = "(13, 29]",
"30+"   = "(30, Inf]",
)
) %>%
ggplot(aes(length_of_stay.factor)) +
geom_bar() +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6, 13]",
"14-29" = "(13, 29]",
"30+"   = "(30, Inf]",
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6, 13]",
"14-29" = "(13, 29]",
"30+"   = "(30, Inf]",
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6,13]",
"14-29" = "(13,29]",
"30+"   = "(29, Inf]",
)
)
x = data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6,13]",
"14-29" = "(13,29]",
"30+"   = "(29, Inf]",
)
) %>%
ggplot(aes(length_of_stay.factor)) +
geom_bar() +
labs(x = "Length of stay (days)")
data_admissions %>%
mutate(
length_of_stay = (discharge_date - admission_date) %>%
as.numeric(),
length_of_stay.factor = length_of_stay %>%
cut(breaks = c(-Inf, 0:6, 13, 29, Inf)) %>%
fct_recode(
"0" = "(-Inf,0]",
"1" = "(0,1]",
"2" = "(1,2]",
"3" = "(2,3]",
"4" = "(3,4]",
"5" = "(4,5]",
"6" = "(5,6]",
"7-13" = "(6,13]",
"14-29" = "(13,29]",
"30+"   = "(29, Inf]",
)
) %>%
ggplot(aes(length_of_stay.factor)) +
geom_bar() +
labs(x = "Length of stay (days)")
View(lookup_icd10)
library(ICD10gm)
x = icd_meta_codes
View(x)
install.packages("icd")
install.packages("icd")
install.packages("C:/Users/james/Downloads/icd_4.0.9.tar.gz", repos = NULL, type="source")
library(icd)
download_all_icd_data()
?download_all_icd_data
get_icd10cm2019()
x = get_icd10cm2019()
y = get_icd10cm2019_pc()
View(x)
View(y)
View(x)
View(x)
x$chapter %>% unique()
View(x)
icd10cm2019
x = get_icd10cm2019()
View(x)
lookup_icd10 = x
saveRDS(lookup_icd10, "icd10cm2019.rds")
