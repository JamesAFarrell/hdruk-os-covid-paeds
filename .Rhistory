geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = scales::date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ admission_method.category)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, admission_method.category, .drop = FALSE) %>%
group_by(admission_method.category) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ admission_method.category)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, treatment_function.category, .drop = FALSE) %>%
group_by(treatment_function.category) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ treatment_function.category)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, treatment_function.category, .drop = FALSE) %>%
group_by(treatment_function.category) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ treatment_function.category, ncol = 2)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, primary_diagnosis.chapter, .drop = FALSE) %>%
group_by(primary_diagnosis.chapter) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ primary_diagnosis.chapter)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, primary_diagnosis.chapter, .drop = FALSE) %>%
group_by(primary_diagnosis.chapter) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ primary_diagnosis.chapter, n = 3)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, primary_diagnosis.chapter, .drop = FALSE) %>%
group_by(primary_diagnosis.chapter) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ primary_diagnosis.chapter, ncol = 3)
?summary_factorlist
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
na_include = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
include_col_totals_percent = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
include_row_missing_col = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
include_row_missing_col = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
include_row_totals_percent = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
add_row_totals = TRUE
) %>%
kable(align = c("l", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
add_row_totals = TRUE
) %>%
kable(align = c("l", "r", "r", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
add_row_totals = TRUE
) %>%
kable(align = c("l", "r", "r", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
na_include = TRUE,
na_to_prop = FALSE
) %>%
kable(align = c("l", "r", "r", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
na_include = TRUE
) %>%
kable(align = c("l", "r", "r", "l", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
na_include = TRUE
) %>%
kable(align = c("l", "l", "r", "r", "r"))
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
na_include = TRUE
) %>%
kable(align = c("l", "l", "r", "r", "r"))
knitr::opts_chunk$set(echo = TRUE)
# Load packages ----
library(tidyverse)
library(lubridate)
library(finalfit)
library(scales)
library(zoo)
library(knitr)
# Load custom functions and lookup tables ----
source(here::here("analysis", "00_utility_functions.R"))
source(here::here("analysis", "00_lookup_tables.R"))
# Plot theme
theme_set(theme_bw())
# Load datasets
data_admissions = read_rds(here::here("output", "data", "data_admissions.rds"))
data_outpatient = read_rds(here::here("output", "data", "data_outpatient.rds"))
data_gp = read_rds(here::here("output", "data", "data_gp.rds"))
# Combine with lookup table ----
## Admissions data ----
### Primary diagnosis ----
data_admissions = data_admissions %>%
left_join(
lookup_icd10 %>%
mutate(
code = code %>% ff_label("Primary diagnosis"),
description_short = description_short %>% ff_label("Primary diagnosis"),
chapter_short = chapter_short %>% ff_label("Primary diagnosis"),
) %>%
select(
primary_diagnosis = code,
primary_diagnosis.description = description_short,
primary_diagnosis.chapter = chapter_short
),
by = "primary_diagnosis"
)
### Treatment function ----
data_admissions = data_admissions %>%
left_join(
lookup_treatment_function %>%
select(
treatment_function = Code,
treatment_function.description = Title,
treatment_function.category = Category
),
by = "treatment_function"
)
### Admission method ----
data_admissions = data_admissions %>%
left_join(
lookup_admission_method %>%
select(
admission_method = Code,
admission_method.description = Description,
admission_method.category = Category
),
by = "admission_method"
)
data_admissions = data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
)
dependent = NULL
explanatory = c("admission_method.category",
"treatment_function.category",
"primary_diagnosis.chapter")
data_admissions %>%
summary_factorlist(
dependent = dependent,
explanatory = explanatory,
add_col_totals = TRUE,
na_include = TRUE
) %>%
kable(align = c("l", "l", "r", "r", "r"))
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, .drop = FALSE) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA),
date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "3 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom")
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, admission_method.category, .drop = FALSE) %>%
group_by(admission_method.category) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ admission_method.category)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, treatment_function.category, .drop = FALSE) %>%
group_by(treatment_function.category) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ treatment_function.category)
data_admissions %>%
mutate(
date = admission_date %>% cut(breaks = "week")
) %>%
count(date, primary_diagnosis.chapter, .drop = FALSE) %>%
group_by(primary_diagnosis.chapter) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA)) %>%
ungroup() %>%
mutate(date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "6 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom") +
facet_wrap(~ primary_diagnosis.chapter, ncol = 3)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(n)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n))
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
filter(row_number()<5)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
filter(row_number()<25)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(perc = n/sum(n)) %>%
filter(row_number()<25)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n), 1), ")")) %>%
filter(row_number()<25)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n), 2), ")")) %>%
filter(row_number()<25)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n)*100, 1), ")")) %>%
filter(row_number()<25)
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n)*100, 1), ")")) %>%
filter(row_number()<25) %>%
kable()
?kable
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n)*100, 1), ")")) %>%
filter(row_number()<25) %>%
kable(align = c("l", "r"),
col.names = c("Primary diagnosis", "n (%)"))
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n)*100, 1), ")")) %>%
filter() %>%
kable(align = c("l", "r"),
col.names = c("Primary diagnosis", "n (%)"))
data_admissions %>%
mutate(treatment_function.description = paste0(treatment_function, ": ",
treatment_function.description)) %>%
count(treatment_function.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", round(n/sum(n)*100, 1), ")")) %>%
filter() %>%
kable(align = c("l", "r"),
col.names = c("Specialty", "n (%)"))
data_admissions %>%
mutate(treatment_function.description = paste0(treatment_function, ": ",
treatment_function.description)) %>%
count(treatment_function.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", format(round(n/sum(n)*100, 1), nsmall = 1), ")")) %>%
filter() %>%
kable(align = c("l", "r"),
col.names = c("Specialty", "n (%)"))
data_admissions %>%
mutate(primary_diagnosis.description = paste0(primary_diagnosis, ": ",
primary_diagnosis.description)) %>%
count(primary_diagnosis.description) %>%
arrange(desc(n)) %>%
mutate(n = paste0(n, " (", format(round(n/sum(n)*100, 1), nsmall = 1), ")")) %>%
filter() %>%
kable(align = c("l", "r"),
col.names = c("Primary diagnosis", "n (%)"))
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
) %>%
ggplot(aes(length_of_stay)) +
geom_histogram()
data_admissions %>%
mutate(
length_of_stay = discharge_date - admission_date
) %>%
ggplot(aes(length_of_stay)) +
geom_histogram() +
labs(x = "Length of stay (days)")
View(data_outpatient)
knitr::opts_chunk$set(echo = FALSE, message=FALSE,
warning=FALSE)
# Load packages ----
library(tidyverse)
library(lubridate)
library(finalfit)
library(scales)
library(zoo)
library(knitr)
# Load custom functions and lookup tables ----
source(here::here("analysis", "00_utility_functions.R"))
source(here::here("analysis", "00_lookup_tables.R"))
# Plot theme
theme_set(theme_bw())
data_outpatient %>%
mutate(
date = outpatient_date %>% cut(breaks = "week")
) %>%
count(date, .drop = FALSE) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA),
date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "3 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom")
View(data_gp)
data_gp %>%
mutate(
date = gp_date %>% cut(breaks = "week")
) %>%
count(date, .drop = FALSE) %>%
mutate(roll_mean = rollmean(n, 4, align = "right", fill = NA),
date = date %>% as_date()) %>%
ggplot(aes(date, n)) +
geom_col() +
geom_line(aes(date, roll_mean, linetype = "4-week averge"), colour = "red") +
scale_x_date(labels = date_format("%b\n%Y"),
breaks = seq(from = ymd("2015-01-01"), to = ymd("2022-12-01"), by = "3 month")) +
labs(y = "Weekly count", x = NULL, linetype = NULL) +
theme(legend.position = "bottom")
