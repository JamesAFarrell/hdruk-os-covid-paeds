tibble(
column_names = c(read_csv(
files_outpatient[1],
n_max = 1,
col_names = FALSE
)))
tibble(
column_names = c(read_csv(
paste0("output/",files_outpatient[1]),
n_max = 1,
col_names = FALSE
)))
?spec
tibble(
column_names = c(read_csv(
paste0("output/",files_outpatient[1]),
n_max = 1,
col_names = FALSE,
)))
tibble(
column_names = c(read_csv(
paste0("output/",files_outpatient[1]),
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
)))
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
tibble(
column_names = c(read_csv(
file,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
))) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
}
?read_csv
xfile = paste0("output/",files_outpatient[1])
read_csv(
xfile,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
)
x = read_csv(
xfile,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
)
x
View(x)
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
)
tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
}
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(.)) %>%
as_tibble()
})
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE
)
tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
}
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(.)) %>%
as_tibble()
})
y = data_outpatient[[1]]
View(y)
read_column_type(xfile)
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE
)
type_string = tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
return(type_string)
}
read_column_type(xfile)
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(.)) %>%
as_tibble()
})
?read_csv
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
show_col_types = FALSE,
progress = FALSE
)
type_string = tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
return(type_string)
}
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(.)) %>%
as_tibble()
})
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(file)) %>%
as_tibble()
})
y = data_outpatient[[4]]
View(y)
read_column_type(paste0("output/", files_outpatient[4]))
?read_csv
data_outpatient = here::here("output", files_outpatient[1]) %>%
read_csv()
View(data_outpatient)
data_outpatient = here::here("output", files_outpatient[5]) %>%
read_csv()
files_outpatient[5]
files_outpatient[4]
files_outpatient[3]
files_outpatient[2]
files_outpatient[1]
files_outpatient
data_outpatient = here::here("output", files_outpatient[2]) %>%
read_csv()
data_outpatient = here::here("output", files_outpatient[1]) %>%
read_csv()
View(data_outpatient)
data_outpatient = here::here("output", files_outpatient[1]) %>%
map(function(file){
read_csv(file, col_types = cols(.default = "c")) %>%
as_tibble()
})
data_outpatient
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
read_csv(file, col_types = cols(.default = "c")) %>%
as_tibble()
})
?map
# Load packages ----
library(tidyverse)
library(lubridate)
library(finalfit)
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
col_types = cols(.default = "c")
)
type_string = tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
return(type_string)
}
# Create directory for processed data and diagnostics ----
dir.create(here::here("output", "data"), showWarnings = FALSE, recursive=TRUE)
dir.create(here::here("output", "diagnostics"), showWarnings = FALSE, recursive=TRUE)
# Data Files ----
files_outpatient = list.files(path = "output", pattern = "input_outpatient_")
files_gp         = list.files(path = "output", pattern = "input_gp_")
files_admissions = list.files(path = "output", pattern = "input_admissions_")
# Read patient data from csv ----
data_patient = read_csv(here::here("output", "input.csv.gz"),
col_types = read_column_type(here::here("output", "input.csv.gz")))
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient[1]) %>%
read_csv()
# data_outpatient = here::here("output", files_outpatient) %>%
#   map(function(file){
#     read_csv(file, col_types = cols(.default = "c")) %>%
#       as_tibble()
#   })
extract_summary_outpatient = data_outpatient %>%
map(function(data){
n_row = nrow(data)
n_row_bad_id = data %>%
filter(!patient_id %in% data_patient$patient_id) %>%
nrow()
n_col = ncol(data)
n_col_empty = data %>%
select_if(function(x) (all(is.na(x)) | all(x==""))) %>%
ncol()
tibble(n_row, n_row_bad_id, n_col, n_col_empty)
}) %>%
bind_rows() %>%
mutate(file = files_outpatient) %>%
relocate(file)
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
extract_summary_outpatient = data_outpatient %>%
map(function(data){
n_row = nrow(data)
n_row_bad_id = data %>%
filter(!patient_id %in% data_patient$patient_id) %>%
nrow()
n_col = ncol(data)
n_col_empty = data %>%
select_if(function(x) (all(is.na(x)) | all(x==""))) %>%
ncol()
#tibble(n_row, n_row_bad_id, n_col, n_col_empty)
tibble(5)
}) %>%
bind_rows() %>%
mutate(file = files_outpatient) %>%
relocate(file)
# Load packages ----
library(tidyverse)
library(lubridate)
library(finalfit)
# Functions ----
# read_column_type: read column name to determine data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
col_types = cols(.default = "c")
)
type_string = tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
return(type_string)
}
# Create directory for processed data and diagnostics ----
dir.create(here::here("output", "data"), showWarnings = FALSE, recursive=TRUE)
dir.create(here::here("output", "diagnostics"), showWarnings = FALSE, recursive=TRUE)
# Data Files ----
files_outpatient = list.files(path = "output", pattern = "input_outpatient_")
files_gp         = list.files(path = "output", pattern = "input_gp_")
files_admissions = list.files(path = "output", pattern = "input_admissions_")
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
# Outpatient data ----
data_outpatient = here::here("output", files_outpatient) %>%
map(function(file){
file %>%
read_csv(col_types = read_column_type(.)) %>%
as_tibble()
})
extract_summary_outpatient = data_outpatient %>%
map(function(data){
n_row = nrow(data)
n_row_bad_id = data %>%
filter(!patient_id %in% data_patient$patient_id) %>%
nrow()
n_col = ncol(data)
n_col_empty = data %>%
select_if(function(x) (all(is.na(x)) | all(x==""))) %>%
ncol()
#tibble(n_row, n_row_bad_id, n_col, n_col_empty)
tibble(5)
}) %>%
bind_rows() %>%
mutate(file = files_outpatient) %>%
relocate(file)
View(extract_summary_outpatient)
?all
sample(1:9)
sample(1:9, replace = TRUE)
sample(1:9, replace = TRUE)
sample(1:9, replace = TRUE)
sample(1:9, replace = TRUE)
sample(1:9, 8, replace = TRUE)
sample(1:10, 8, replace = TRUE)
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
# Load packages ----
library(tidyverse)
library(lubridate)
library(finalfit)
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
# Functions ----
# read_column_type: read column name to determine column data type
read_column_type = function(file){
first_row = read_csv(
file,
n_max = 1,
col_names = FALSE,
col_types = cols(.default = "c")
)
type_string = tibble(
column_names = c(first_row)) %>%
mutate(column_type = case_when(
column_names == "patient_id" ~ "i",
str_detect(column_names, "_date") ~ "D",
str_detect(column_names, "imd_") ~ "i",
str_detect(column_names, "age") ~ "d",
str_detect(column_names, "_count") ~ "i",
TRUE ~ "c"
)) %>%
pull(column_type) %>%
paste(collapse = "")
return(type_string)
}
# Read patient data from csv ----
data_patient = here::here("output", "input.csv.gz") %>%
read_csv(col_types = read_column_type(.))
data_patient$covid_positive_test_date_1
data_patient$covid_positive_test_date_1 %>% min()
data_patient$covid_positive_test_date_1 %>% min(rm.na = TRUE)
data_patient$covid_positive_test_date_1 %>% min(na.rm = TRUE)
data_patient$covid_positive_test_date_1 %>% summary()
data_patient$covid_negative_test_date_1 %>% summary()
data_patient$covid_negative_test_date_2 %>% summary()
sampe(1:9, 10, replace = TRUE)
sampel(1:9, 10, replace = TRUE)
sample(1:9, 10, replace = TRUE)
sample(1:10, 10, replace = TRUE)
library(MatchIt)
library(tidyverse)
library(finalfit)
colon
data_colon = colon_s
View(data_colon)
matchit(status.factor ~ age, data = data_colon)
m0 = matchit(status.factor ~ age, data = data_colon)
m0$match.matrix
?matchit
m0 = matchit(status.factor ~ age + hospital,
data = data_colon,
)
m0$match.matrix
summary(m0)
m0 = matchit(status.factor ~ age + sex + hospital,
data = data_colon,
)
summary(m0)
m0 = matchit(status.factor ~ age + sex + hospital,
data = data_colon,
method = NULL,
distance = "glm"
)
summary(m0)
m1.nearest = matchit(status.factor ~ age + sex + hospital,
data = data_colon,
method = "nearest",
distance = "glm"
)
summary(m1.nearest)
m1.full = matchit(status.factor ~ age + sex + hospital,
data = data_colon,
method = "full",
distance = "glm"
)
install.packages("optmatch")
m1.full = matchit(status.factor ~ age + sex + hospital,
data = data_colon,
method = "full",
distance = "glm"
)
summary(m1.full)
m1.full$X
m1.full$weights
m1.full = matchit(status.factor ~ age + sex,
data = data_colon,
method = "full",
distance = "glm"
)
summary(m1.full)
m1.full = matchit(status.factor ~ age + sex,
data = data_colon,
method = "glm",
distance = "glm"
)
m1.full = matchit(status.factor ~ age + sex,
data = data_colon,
method = "nearest",
distance = "glm"
)
summary(m1.nearest)
summary(m1.nearest) %>% plot()
summary(m1.nearest) %>% plot()
m1.nearest = matchit(status.factor ~ age + sex,
data = data_colon,
method = "nearest",
distance = "glm"
)
summary(m1.nearest) %>% plot()
m1.nearest = matchit(status.factor ~ age + sex + extent.factor,
data = data_colon,
method = "nearest",
distance = "glm"
)
summary(m1.nearest) %>% plot()
m1.exact = matchit(status.factor ~ age + sex + extent.factor,
data = data_colon,
method = "exact",
distance = "glm"
)
summary(m1.exact)
summary(m1.exact) %>% plot()
m1.nearest = matchit(status.factor ~ age + sex + extent.factor,
data = data_colon,
method = "nearest",
distance = "glm"
)
summary(m1.nearest) %>% plot()
